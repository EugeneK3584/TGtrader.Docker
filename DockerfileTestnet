# For more information, please refer to https://aka.ms/vscode-docker-python
# Dockerfile
FROM python:3.11.7 AS tgtrader-testnet
EXPOSE 5000
ENV buildTag=1.0

RUN mkdir -p /home/tgtrader
RUN groupadd --gid 1004 tgtrader
RUN useradd tgtrader -g tgtrader --uid 1001 --shell /bin/bash -d /home/tgtrader
RUN usermod -aG users,adm tgtrader
RUN chown -R tgtrader:tgtrader /home/tgtrader
#RUN chown -R tgtrader:tgtrader /TGtrader
#USER tgtrader

WORKDIR /TGtrader
COPY ./TGtrader/requirements.in /tmp/requirements.txt

RUN pip3 install --upgrade pip
RUN --mount=type=cache,mode=0755,target=/root/.cache/pip pip3 install "Flask[async]"
RUN --mount=type=cache,mode=0755,target=/root/.cache/pip pip3 install pip-tools 
RUN --mount=type=cache,mode=0755,target=/root/.cache/pip pip3 install pipreqs
RUN --mount=type=cache,mode=0755,target=/root/.cache/pip pip3 install -r /tmp/requirements.txt

ENV PATH="${PATH}:/TGtrader" \
    FLASK_APP=app \
    PIP_NO_CACHE_DIR=yes \
    PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 

ENTRYPOINT ["python3"]
CMD ["-u","tgtrader_main.py","testnet"]




